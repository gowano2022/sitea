<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>My Website</title>
	<!-- Include jQuery library from Google CDN -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<!-- Include custom JavaScript code -->
	<script>
		function getLocation() {
		    if (navigator.geolocation) {
		        navigator.geolocation.getCurrentPosition(showPosition, showError);
		    } else {
		        alert('Geolocation is not supported by this browser.');
		    }
		}

		function showPosition(position) {
		    var lat = position.coords.latitude;
		    var lng = position.coords.longitude;
		    var location = lat + ' ' + lng;
		    $('#location').html(location);
		    saveLocationToServer(location, getIP());
		}

		function showError(error) {
		    switch(error.code) {
		        case error.PERMISSION_DENIED:
		            saveLocationToServer('permission denied', getIP());
		            alert('User denied the request for geolocation.');
		            break;
		        case error.POSITION_UNAVAILABLE:
		            saveLocationToServer('position unavailable', getIP());
		            alert('Location information is unavailable.');
		            break;
		        case error.TIMEOUT:
		            saveLocationToServer('position timeout', getIP());
		            alert('The request to get user location timed out.');
		            break;
		        case error.UNKNOWN_ERROR:
		            saveLocationToServer('unknown error', getIP());
		            alert('An unknown error occurred.');
		            break;
		    }
		}

		function getIP() {
		    var ip = null;
		    $.ajax({
		        url: 'https://api.ipify.org?format=jsonp',
		        type: 'GET',
		        dataType: 'jsonp',
		        async: false,
		        success: function(json) {
		            ip = json.ip;
		        },
		        error: function(xhr, textStatus, errorThrown) {
		            console.error('Error getting IP address:', errorThrown);
		        }
		    });
		    return ip;
		}

		function saveLocationToServer(location, ip) {
		    if (window.File && window.FileReader && window.FileSystem) {
		        window.webkitRequestFileSystem(window.PERSISTENT, 1024 * 1024, function(fs) {
		            fs.root.getFile('location.txt', { create: true }, function(fileEntry) {
		                fileEntry.createWriter(function(fileWriter) {
		                    var data = new Blob([`${new Date().toLocaleString()} - Location: ${location} - IP: ${ip}\n`], { type: 'text/plain' });
		                    fileWriter.write(data);
		                    console.log('Location data saved to file');
		                }, function(error) {
		                    console.error('Error creating FileWriter:', error);
		                });
		            }, function(error) {
		                console.error('Error creating or opening file:', error);
		            });
		        }, function(error) {
		            console.error('Error requesting file system:', error);
		        });
		    } else {
		        console.error('File System API not supported by the browser');
		    }
		}

		$(document).ready(function() {
			getLocation();
		});
	</script>
</head>
<body>
	<h1>My Website</h1>
	<p>Your location: <span id="location"></span></p>
</body>
</html>